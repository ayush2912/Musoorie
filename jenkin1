pipeline{
agent any
 environment {
                    listd="docker ps -q"
                    listf="docker ps -a -q"
                    liste="docker images -a -q"
}
stages{
 stage(compile){
    steps{
         sh 'mvn compile'
         }
}
 stage(test){
     steps{
        sh 'mvn test'
      }
}
 stage(pacakge){
steps{
        sh 'mvn package'
      }
}
 stage(deploy){
 
     
steps{
 sh "docker kill $listd"
sh "sudo docker rm ${listf}"
sh " docker rmi ${liste}"
 sh 'sudo docker build -t ayush3:$BUILD_NUMBER .'
sh' sudo docker container run -itd --name ayush$BUILD_NUMBER -p 8082:8080 ayush3:$BUILD_NUMBER '

}
}

}
}
